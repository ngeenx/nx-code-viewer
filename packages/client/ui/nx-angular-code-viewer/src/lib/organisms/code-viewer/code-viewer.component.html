<article [class]="theme() + ' border-' + borderStyle()">
  <!-- Border overlay for grid-cross style -->
  @if (borderStyle() === 'grid-cross') {
    <div class="border-overlay">
      <div class="border-top"></div>
      <div class="border-bottom"></div>
      <div class="border-left"></div>
      <div class="border-right"></div>
      <div class="corner-cross corner-top-left-h"></div>
      <div class="corner-cross corner-top-left-v"></div>
      <div class="corner-cross corner-top-right-h"></div>
      <div class="corner-cross corner-top-right-v"></div>
      <div class="corner-cross corner-bottom-left-h"></div>
      <div class="corner-cross corner-bottom-left-v"></div>
      <div class="corner-cross corner-bottom-right-h"></div>
      <div class="corner-cross corner-bottom-right-v"></div>
    </div>
  }

  <!-- Border overlay for corner-intersection style -->
  @if (borderStyle() === 'corner-intersection') {
    <div class="border-overlay">
      <div class="border-top-extended"></div>
      <div class="border-bottom-extended"></div>
      <div class="border-left-extended"></div>
      <div class="border-right-extended"></div>
    </div>
  }

  @if (showHeader()) {
    <nx-code-header
      [language]="language()"
      [title]="title()"
      [theme]="theme()"
      [fileExtension]="fileExtension()" />
  }

  <nx-code-block
    [content]="highlightedContent()"
    [rawCode]="normalizedCode()"
    [lineCount]="lineCount()"
    [theme]="theme()"
    [showLineNumbers]="showLineNumbers()"
    [wordWrap]="wordWrap()"
    [maxHeight]="maxHeight()"
    [isLoading]="isLoading()"
    [showCopyButton]="showCopyButton()"
    [copyState]="copyState()"
    [copyClick]="handleCopyClick"
    [highlightedLinesSet]="highlightedLinesSet()"
    [focusedLinesSet]="focusedLinesSet()"
    [collapsedRangesState]="collapsedRangesState()"
    [processedReferences]="processedReferencesMap()"
    [lineWidgets]="lineWidgets()"
    (referenceClick)="onReferenceClick($event)"
    (referenceHover)="onReferenceHover($event)"
    (collapsedRangeToggle)="onCollapsedRangeToggle($event)"
    (lineWidgetClick)="onLineWidgetClick($event)" />
</article>

<!-- Reference info popover -->
@if (activePopover()) {
  <nx-reference-popover
    [content]="activePopover()!.reference.content ?? ''"
    [anchorElement]="activePopover()!.anchorElement"
    [theme]="theme()"
    [visible]="true"
    [matchedText]="activePopover()!.reference.matchedText"
    [captureGroups]="activePopover()!.reference.captureGroups"
    [lineNumber]="activePopover()!.reference.lineNumber"
    (mouseEnter)="onPopoverMouseEnter()"
    (mouseLeave)="onPopoverMouseLeave()" />
}
